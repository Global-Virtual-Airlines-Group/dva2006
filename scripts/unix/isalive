#!/bin/sh
# System daemon checking script
# (c) 2005 Global Virtual Airlines Group. All Rights Reserved.

if [ -f "/var/run/siteDown.flag" ]
then
 echo "/var/run/siteDown.flag set - aborting"
 exit
fi

if [ -f "/var/run/named.pid" ]
then
  if [ -d "/proc/`cat /var/run/named.pid`" ]
  then
   echo "BIND (DNS Server) is alive"
  else
   echo "BIND (DNS Server) is DOWN"
   /usr/local/sbin/namedctl start
  fi
else
 echo "BIND (DNS Server) is DOWN - no pid"
 /usr/local/sbin/namedctl start
fi

if [ -f "/var/run/mysql5.pid" ]
then
  if [ -d "/proc/`cat /var/run/mysql5.pid`" ]
  then
   echo "mySQL 5 (Database Server) is alive"
  else
   echo "mySQL 5 (Database Server) is DOWN"
   /usr/local/sbin/mysql5ctl start
  fi
else
 echo "mySQL 5 (Database Server) is DOWN - no pid"
 /usr/local/sbin/mysql5ctl start
fi

if [ -f "/var/run/tomcat55.pid" ]
then
  if [ -d "/proc/`cat /var/run/tomcat55.pid`" ]
  then
   echo "Tomcat (Application Server) is alive"
  else
   echo "Tomcat (Application Server) is DOWN"
   /usr/local/sbin/tomcatctl start
  fi
else
  echo "Tomcat (Application Server) is DOWN - no pid"
  /usr/local/sbin/tomcatctl start
fi

if [ -f "/var/run/httpd.pid" ]
then
  if [ -d "/proc/`cat /var/run/httpd.pid`" ]
  then
   echo "Apache (Web Server) is alive"
  else
   echo "Apache (Web Server) is DOWN"
   /usr/local/sbin/apachectl start
  fi
else
  echo "Apache (Web Server) is DOWN - no pid"
  /usr/local/sbin/apachectl start
fi

if [ -f "/var/run/slapd.pid" ]
then
  if [ -d "/proc/`cat /var/run/slapd.pid`" ]
  then
   echo "OpenLDAP (Authentication Server) is alive"
  else
   echo "OpenLDAP (Authentication Server) is DOWN"
   /usr/local/sbin/ldapctl start
  fi
else
  echo "OpenLDAP (Authentication Server) is DOWN - no pid"
  /usr/local/sbin/ldapctl start
fi

if [ -f "/var/run/postfix-master.pid" ]
then
  if [ -d "/proc/`pidof postfix/master`" ]
  then
   echo "PostFix (SMTP Server) is alive"
  else
   echo "PostFix (SMTP Server) is DOWN"
   postfix start
  fi
else
 echo "PostFix (SMTP Server) is DOWN - no pid"
 postfix start
fi

if [ -f "/var/run/spamd.pid" ]
then
  if [ -d "/proc/`cat /var/run/spamd.pid`" ]
  then
   echo "SpamAssassin (Spam Filtering Server) is alive"
  else
   echo "SpamAssassin (Spam Filtering Server) is DOWN"
   spamdctl start
  fi
else
 echo "SpamAssassin (Spam Filtering Server) is DOWN - no pid"
 spamdctl start
fi

if [ -f "/var/run/authdaemon.pid" ]
then
  if [ -d "/proc/`cat /var/run/authdaemon.pid`" ]
  then
   echo "IMAP Authentication Server is alive"
  else
   echo "IMAP Authentication Server is DOWN"
   authdaemond start
  fi
else
 echo "IMAP Authentication Server is DOWN - no pid"
 authdaemond start
fi

if [ -f "/var/run/imapd.pid" ]
then
  if [ -d "/proc/`cat /var/run/imapd.pid`" ]
  then
   echo "Courier (IMAP Server) is alive"
  else
   echo "Courier (IMAP Server) is DOWN"
   /usr/local/sbin/imapctl start
  fi
else
 echo "Courier (IMAP Server) is DOWN - no pid"
 /usr/local/sbin/imapctl start
fi

if [ -f "/var/run/ts2.pid" ]
then
  if [ -d "/proc/`cat /var/run/ts2.pid`" ]
  then
    echo "TeamSpeak (Voice Server) is alive"
  else
    echo "TeamSpeak (Voice Server) is DOWN"
    /usr/local/sbin/ts2ctl start
  fi
else
 echo "TeamSpeak (Voice Server) is DOWN - no pid"
 /usr/local/sbin/ts2ctl start
fi
